@model IEnumerable<Negocio.Objetos.Habitacion>

@{
    ViewBag.Title = "Available";

}

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<div class="container">
    <h2>Habitaciones Disponibles </h2>
    <div class="row row-xl row-30 row-md-50 row-xl-70">
        @foreach (var item in Model)
        {

            Dominio.MainModule.CategoriaManager cm = new Dominio.MainModule.CategoriaManager();
            var objH = cm.Find(item.cat_id);

            Dominio.MainModule.PisoManager pm = new Dominio.MainModule.PisoManager();
            var objP = pm.Find(item.id_piso);

            var clase = "btn btn-primary";
            var idhabitacion = @Html.DisplayFor(modelItem => item.num_habi);
            <div class="col-sm-6 col-lg-2 wow fadeInUp">
                <div class="imagen">
                    <img class="img-thumbnail" src="@Html.DisplayFor(modelItem => item.img_habi)" alt="image">
                </div>
                <div>
                    <p hidden>@Html.DisplayFor(modelItem => item.num_habi)</p>
                    <h2>@Html.DisplayFor(modelItem => item.desc_habi)</h2>
                    <p>@Html.DisplayFor(modelItem => item.precio_habi)</p>
                    <p>@Html.DisplayFor(modelItem => item.estado_habi)</p>
                    <p>@objH.desc_cat</p>
                    <p>@objP.desc_piso</p>

                    @if (Session["carrito"] != null)
                    {
                        foreach (var x in Session["carrito"] as List<Negocio.Objetos.ItemCarrito>)
                        {
                            if (x.habitacion.num_habi == item.num_habi)
                            {
                                clase = "btn btn-primary disabled";

                            }
                        }
                    }
                    <p>
                        <a class="@clase agregar" href="#">Agregar</a>
                    </p>
                </div>
            </div>
        }
    </div>
</div>

@section scripts{
    <script>
        $(".agregar").click(function (event) {
            event.preventDefault();
            let idhabitacion = $(this).parent().parent().find("p:eq(0)").text(); // sale hasta el padre <div> y busca p en la posicion 0
            $.ajax({
                url: "@Url.Action("AgregarCarrito","Home")",
                data: { id: idhabitacion },
                type: "POST",
                success: function (response) {
                    window.location.href = "@Url.Action("AgregarCarrito", "Home")";
                },
                error: function (xhr, error) {
                    alert(error);
                }
            });
        })


    </script>

}